# Use Node.js Alpine image for development
FROM node:24-alpine

WORKDIR /app

# Disable Next.js telemetry
ENV NEXT_TELEMETRY_DISABLED=1 \
    LANG=C.UTF-8

# Create non-root user for security
RUN addgroup -g 1001 -S nodejs && \
    adduser -S nextjs -u 1001

# Copy package files
COPY package*.json ./

# Install dependencies as root
RUN npm ci && npm cache clean --force

# Change ownership of entire app directory to nextjs user
RUN chown -R nextjs:nodejs /app

# Switch to non-root user for runtime
USER nextjs

# Copy configuration files
COPY components.json \
     next.config.mjs \
     postcss.config.mjs \
     tailwind.config.ts \
     tsconfig.json ./

# Copy source code and public assets
COPY public/ ./public/
COPY src/ ./src/

# Expose development port
EXPOSE 3000

# Start application in development mode
CMD ["npm", "run", "dev"]
